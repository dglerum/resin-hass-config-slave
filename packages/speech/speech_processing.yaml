######################################################################################################
###Script to actually send notifications to the Apple TV during normal hours and only when we are home! Call like this:
  # action:
    # service: script.speech_engine
    # message:
# # @CCOSTAN
# Original Repo : https://github.com/CCOSTAN/Home-AssistantConfig
######################################################################################################
script:
  speech_processing:
    sequence:
      # - service: mqtt.publish
      #   data_template:
      #     topic: 'polly/lastmsg'
      #     payload: "This message is from {{ now().strftime('%-I') }}:{{ now().strftime('%M') }} {{ now().strftime('%p') }}. {{ speech_message | truncate(220)}}"
      #     retain: true
      - condition: or
        conditions:
          - condition: time
            after: '09:00:00'
            before: '22:30:00'
          - condition: state
            entity_id: input_boolean.alert_mode
            state: 'on'
      - condition: state
        entity_id: input_boolean.speech_notifications
        state: 'on'

      # - service: media_player.alexa_tts
      #   data_template:
      #     entity_id: media_player.davys_echo_dot
      #     message: >-
      #       '{{ speech_message }}'

      - service: mqtt.publish
        data_template:
          topic: 'polly/lastmsg'
          payload: >-
            {{speech_message}}
          retain: true

      - service: input_boolean.turn_off
        entity_id:
          # - input_boolean.alert_mode
          - input_boolean.lastmsg
